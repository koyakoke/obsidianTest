---
Related: ["cursorのcodebaseってなに？", "クラウドのベクトルDBにチャンク分割してベクトル化したものを保存しているということ？"]
aliases: ["CursorのAI理解の仕組み", "AI IDEの動作原理"]
tags:
- cursor
- AI
- RAG
- langchain
- embedding
- vector-search
---
「Cursor（AI IDE）などがプロジェクト全体を理解している」と言えるのは、**プロジェクト内のコード・構造・関係性を事前に解析し、AIがそれを踏まえて応答する仕組みがあるから**です。

以下にその仕組みを、LangChainやRAGの知識ともリンクさせながら、わかりやすく解説します。

---

## ✅ 仕組みの概要：AIはこうやってプロジェクトを理解している

### 🔹 ステップ1：**コード全体を読み込む**

- Cursorはプロジェクト内の全ファイルを自動で走査します。
- `.py`, `.js`, `.ts`, `.json`, `.md` など、対象ファイルの中身を読み取ります。

### 🔹 ステップ2：**コードをチャンク分割する**

- 1つ1つのファイルは長いため、**意味のまとまりごとにチャンク化**（例：関数単位や数百トークン単位）。
- これはLangChainで使われる `RecursiveCharacterTextSplitter` や ASTベースの `CodeSplitter` のような処理と同様です。

### 🔹 ステップ3：**チャンクごとにベクトル埋め込み（Embedding）**

- 各チャンクを、OpenAIの `text-embedding-ada-002` や `CodeBERT` などの埋め込みモデルで「意味を数値ベクトル」に変換。
- これにより、**似ているコードや目的に近いチャンクを高速検索可能**になります。

<aside> ❓

[ベクトル埋め込み等をIDEの中（ローカル環境）でやっているということ？](https://www.notion.so/IDE-1fa5f8842f0b8083be19e2eed62c87fa?pvs=21)

→クラウドでやってるらしい

</aside>

[上記について文献を調べてみる。](https://www.notion.so/1fb5f8842f0b80afae94f0e6bb95f440?pvs=21)

<aside> ❓

[クラウドのベクトルDBにチャンク分割してベクトル化したものを保存しているということ？](https://www.notion.so/DB-1fa5f8842f0b80fda155ca0584429ead?pvs=21)

→

</aside>

### 🔹 ステップ4：**ベクトル検索で関連コードを取得**

- ユーザーが「この関数バグってる？」などと聞いたとき、**その質問と意味的に近いチャンクを検索**。
- たとえば「updateUserProfile()」という単語が入っていれば、関連する定義・使用箇所などがヒットします。

### 🔹 ステップ5：**文脈としてAIに渡す（RAGの流れ）**

- 検索で得たチャンク（数個）を、質問と一緒にGPT-4などのLLMに投げます。
- これにより「AIがプロジェクト全体を理解しているかのような回答」が可能になります。

---

## 🔍 補足：内部的にはRAGとほぼ同じ

CursorやGitHub Copilot Chatは、次のような「検索拡張生成（RAG）」の考え方で動いています：

```
text
コピーする編集する
ユーザーの質問
   ↓
意味の近いコードチャンクを検索（ベクトル検索）
   ↓
そのチャンク＋質問をGPT-4などに入力
   ↓
文脈を踏まえた回答が得られる
```

---

## 🔧 メタデータも使う

- チャンクには「ファイル名」「関数名」「行番号」などの**メタデータ**も含まれます。
- 回答に「該当箇所は `user_service.py` の 24行目付近です」と出せるのはこのためです。

---

## ✅ まとめ

|処理|内容|
|---|---|
|コード収集|プロジェクト内のファイルを読み取る|
|チャンク分割|関数や構文単位で小分け|
|ベクトル化|意味を数値ベクトルに変換|
|ベクトル検索|質問に関連するチャンクを取得|
|LLM入力|検索結果＋質問でGPTに文脈を渡す|

---

## 🚀 もし自分で同じ仕組みを作るなら？

以下のような技術を組み合わせれば、Cursor的なRAG開発環境を構築できます：

- `LangChain` or `LlamaIndex`：チャンク化とベクトルDB管理
- `text-embedding-ada-002` or `CodeBERT`：コード埋め込み
- `Chroma`, `FAISS`, `Weaviate`：ベクトルストア
- `Streamlit`, `Gradio`：チャットUI
- GitHub API：コードの自動取得

---